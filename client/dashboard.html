<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.css">
    <script src="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="geojson/freguesias.geojson"></script>
    <script src="geojson/metro.geojson"></script>

    <link rel="stylesheet" href="css/dashboard.css">
    <title> Dashboard </title>

</head>

<style>
    body {
        font-family: "Raleway", Sans-serif;
        -webkit-font-smoothing: antialiased;
    }

    .tab-content {

        padding-left: 50px;
        padding-right: 50px;
        text-align: justify;
    }



    h1,
    h2,
    h3,
    h4,
    h5 {
        letter-spacing: -0.04em;
        font-weight: 700;
        font-style: normal;
        font-family: "Raleway", Sans-serif;
        color: #4A4A4A;
    }

    p {
        font-family: 'Raleway', sans-serif;
        font-size: 15px;
        font-weight: 400;
        line-height: 24px;
        color: #000;
    }

    #logo {
        height: 35%;
        width: 35%;

    }


    #map_canvas {
        display: block;
        margin-left: auto;
        margin-right: auto;

        height: 700px;

    }

</style>


<body>


    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://www.thalesgroup.com/en">Thales</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a id="Home" data-toggle="pill" href="#home">Home</a></li>
                <li><a id="Mapa" data-toggle="pill" href="#mapa">Mapa</a></li>
                <li><a id="Estatisticas" data-toggle="pill" href="#estatisticas">Estatísticas</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a> Logout </a></li>
            </ul>
        </div>
    </nav>


    <div class="tab-content" style="padding-top: 10px ">
        <div id="home" class="tab-pane fade in active">
                <div id="carousel" class="carousel slide" data-ride="carousel">
                <!-- Menu -->
                <ol class="carousel-indicators">
                    <li data-target="#carousel" data-slide-to="0" class="active"></li>
                    <li data-target="#carousel" data-slide-to="1"></li>
                    <li data-target="#carousel" data-slide-to="2"></li>
                </ol>

                <!-- Items -->
                <div class="carousel-inner" role="listbox">

                    <div class="item active">
                        <img src="https://picsum.photos/1500/600?image=1" alt="Slide 1" />
                        <div class= "carousel-caption">
                        <h1> Myfirst Caption</h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="https://picsum.photos/1500/600?image=2" alt="Slide 2" />
                    </div>

                    <div class="item">
                        <img src="https://picsum.photos/1500/600?image=3" alt="Slide 3" />
                    </div>
                </div>
                    <!-- Slider control -->
                <a href="#carousel" class="left carousel-control" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                </a>
                <a href="#carousel" class="right carousel-control" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </a>
            </div>
            ljvznlzvn
        </div>

    <div id="mapa" class="tab-pane fade">
        <div id="map_canvas"></div>

    </div>
    <div id="estatisticas" class="tab-pane fade">
        <div id="chart-container">Graficos
            <div id="estatisticas1">
            </div>
            <div id="estatisticas2">
            </div>
            <div id="estatisticas3">
            </div>
        </div>
    </div>
    </div>


    <script>
        //Estatisticas Tab with chart.js

        google.charts.load('current', {
            'packages': ['corechart']
        });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            $.getJSON('http://localhost:3000/getEstatisticas1', function(data) {
                console.log(data);
                var items = [
                    ['Age', 'Number']
                ];
                for (item in data) {
                    var i = [data[item].Age, parseInt(data[item].Number)];
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Faixa Etária',
                    width: 900,
                    height: 500
                };

                var chart = new google.visualization.BarChart(document.getElementById('estatisticas1'));

                chart.draw(dataTable, options);

            });

            //------------------------------------------------------

            $.getJSON('http://localhost:3000/getEstatisticas2', function(data) {
                var items = [
                    ['Tranport', 'Number']
                ];
                for (item in data) {
                    var i = [data[item].Transport, parseInt(data[item].Number)];
                    console.log(i);
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Transporte',
                    width: 900,
                    height: 500
                };

                var chart = new google.visualization.PieChart(document.getElementById('estatisticas2'));
                chart.draw(dataTable, options);


            });

            //---------------------------------------------------------------------------------------------------

            $.getJSON('http://localhost:3000/getEstatisticas3', function(data) {
                var items = [
                    ['Hour', 'Number']
                ];
                for (item in data) {
                    var i = [data[item].Hour, parseInt(data[item].Number)];
                    console.log(i);
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Transporte',
                    width: 900,
                    height: 500
                };

                var chart = new google.visualization.LineChart(document.getElementById('estatisticas3'));
                chart.draw(dataTable, options);

            });
        }

        //map tab with leaflet

        $('#Mapa').click(function(e) {
            setTimeout(function() {
                map.invalidateSize()
            }, 500);

            var lat = 38.7071; //center
            var long = -9.13549; //center
            var map = L.map('map_canvas').setView([lat, long], 11.5);
            //mapa tile init
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var freguesiaStyle = {
                "color": "#EDA24C",
                "weight": 5,
                "opacity": 0.65
            };
            // metro icon
            var mIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });
            //button icon
            var fIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });



            function onEachFeature(feature, layer) {
                if (feature.properties.INF_NOME) {
                    layer.setIcon(mIcon);
                    if (feature.properties.INF_DESCRICAO == "NULL") {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".");
                    } else {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".<br> Correspondente à " + feature.properties.INF_DESCRICAO + ".");
                    }
                }

            }
            L.geoJSON(metro, {
                onEachFeature: onEachFeature
            }).addTo(map);


            $.getJSON('http://localhost:3000/getCoordenadas', function(data) {
                /*var items = {
                    "type":"LineString",
                    "coordinates": []
                });*/
                var items = [];
                for (point in data)
                    items.push([
                        [data[point].ORIGIN_LATITUDE, data[point].ORIGIN_LONGITUDE],
                        [data[point].DESTINATION_LATITUDE, data[point].DESTINATION_LONGITUDE, data[point].NAME]
                    ]);




                L.polyline(items, {
                        color: 'red'
                    }).bindPopup()
                    .addTo(map)
                    .showMeasurements();


            });

            var helloPopup = L.popup().setContent('Este é o centro de Lisboa!');
            //Center map of Lisbon
            L.easyButton('<img src="https://img.icons8.com/material/24/000000/center-direction.png" style="width:16px" >', function(btn, map) {
                helloPopup.setLatLng(map.getCenter()).openOn(map);
                map.setView([lat, long], 11.5);

            }).addTo(map);


            function onEachFreguesia(feature, layer) {
                if (feature.properties && feature.properties.NOME) {
                    layer.bindPopup(feature.properties.NOME);
                }
            }


            var stateChangingButton = L.easyButton({
                states: [{
                    stateName: 'showFreguesias', // name the state
                    icon: 'fa-tree', // and define its properties
                    title: 'mostra freguesias', // like its title
                    onClick: function(btn, map) { // and its callback
                        geojsonLayer = L.geoJSON(freguesias, {
                            style: freguesiaStyle,
                            onEachFeature: onEachFreguesia
                        });
                        geojsonLayer.addTo(map);
                        btn.state('hideFreguesias'); // change state on click!   // change state on click!
                    }
                }, {
                    stateName: 'hideFreguesias',
                    icon: 'fa-university',
                    title: 'esconde freguesias',
                    onClick: function(btn, map) {
                        map.setView([lat, long], );
                        map.removeLayer(geojsonLayer);

                        btn.state('showFreguesias');
                    }
                }]
            });

            stateChangingButton.addTo(map);



        });

    </script>
</body>

</html>
