<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.css">
    <script src="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="geojson/freguesias.geojson"></script>
    <script src="geojson/metro.geojson"></script>
    <script src="javascript/map.js"></script>
    <script src="javascript/register.js"></script>
    <script src="javascript/stat.js"></script>

    <link rel="stylesheet" href="css/dashboard.css">
    <title> Dashboard </title>

</head>

<body>


    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://www.thalesgroup.com/en">Thales</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a id="Home" data-toggle="pill" href="#home">Home</a></li>
                <li><a id="Mapa" data-toggle="pill" href="#mapa">Mapa</a></li>
                <li><a id="Estatisticas" data-toggle="pill" href="#estatisticas">Estatísticas</a></li>
                <li><a id="Fale_Connosco" data-toggle="pill" href="#fale_connosco">Fale Connosco</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <form action="/logout" id="logout" method="get">
                    <li><input id="bLogout" type="submit" value="Logout" /></li>
                </form>
            </ul>
        </div>
    </nav>
    <div class="tab-content" style="padding-top: 10px ">
        <div id="home" class="tab-pane fade in active">
            <header>
                <h1>Como-Te-Moves</h1>
            </header>
            <div id="carousel" class="carousel slide" data-ride="carousel">
                <!-- Menu -->
                <ol class="carousel-indicators">
                    <li data-target="#carousel" data-slide-to="0" class="active"></li>
                    <li data-target="#carousel" data-slide-to="1"></li>
                    <li data-target="#carousel" data-slide-to="2"></li>
                </ol>

                <!-- Items -->
                <div class="carousel-inner" role="listbox">

                    <div class="item active">
                        <img src="http://agents-prod-cd-portal.azurewebsites.net/-/media/Deals/Deals%202018/Peregrine-Portugal.jpg" alt="Slide 1" />
                        <div class="carousel-caption">
                            <h1 style="color: aliceblue">Lisboa</h1>
                        </div>
                    </div>

                    <div class="item">
                        <img src="https://img.muvtravel.com/destinations/35_China/35_China_0633219.jpg" alt="Slide 2" />
                    </div>

                    <div class="item">
                        <img src="http://www.emoss.nl/wp-content/uploads/000404_CITY_BUS_HEADER.jpg" alt="Slide 3" />
                    </div>
                </div>
                <!-- Slider control -->
                <a href="#carousel" class="left carousel-control" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                </a>
                <a href="#carousel" class="right carousel-control" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </a>
            </div>
            <div class="container" id="acerca">
                <div class="row">
                    <div class="col-md-12">
                        <h2 style="text-align: center" class="sobreNos">Sobre nós</h2>
                        <p id="sumario">O uso de smartphones, smartwatches ou outros dispositivos aumentou rapidamente nos últimos anos e além das capacidades comunicação, hoje estes estão equipados com vários sensores que andam com o seu utilizador ao longo de todo o dia. Os dados adquiridos através destes dispositivos (por exemplo, localização, movimento, som, entre outros dados contextuais) podem ser uma fonte valiosa de informação para avaliar várias temáticas, tais como analisar o modo como as pessoas se movem na cidade. Estas podem deslocar-se a pé, de bicicleta, transportes públicos ou usando outros meios de mobilidade.

                            A aplicação Como-Te-Moves tem como propósito fornecer informação acerca dos meios de mobilidade da cidade de Lisboa, de forma a caracterizar como as pessoas se deslocam na mesma. Estes dados podem capacitar a caracterização de zonas ou trajetos da cidade, onde esta pode ser utilizada como fonte de informação na hora de planear reestruturações na cidade (planeamento urbano, rede de transportes, etc). A plataforma disponibiliza um conjunto de estatísticas que serão uteis para a recolha de dados quanto a forma como se deslocam os lisboetas, sendo que difere consoante as faixas etárias e consoante a localização na zona de Lisboa.
                        </p>
                        <hr>
                    </div>
                    <h2 style="text-align: center" class="sobreNos">Os nossos transportes</h2>
                    <div class="col-md-6" id="metro">
                        <p><img id="metroHome" src="https://portoalities.com/wp-content/uploads/2016/07/como-usar-o-metro-do-porto.jpg">
                            Em 14 de dezembro de 2016, foi anunciado o prolongamento da linha amarela até ao Cais do Sodré, com a rede do metropolitano a ganhar mais duas estações: uma na Estrela e outra em Santos. A obra irá custar ao todo cerca de 215 milhões de euros e deverá estar concluída em 2021.[31]

                            No dia 8 de maio de 2017, o Ministro do Ambiente, Dr. João Pedro Matos Fernandes, apresentou a versão final e oficial para o plano de expansão da rede de metropolitano até 2022, com um custo total de 216 milhões de euros, revelando que o prolongamento já anunciado Rato - Cais do Sodré seria integrado numa linha circular, a qual aproveitaria o traçado das actuais linhas Linha Amarela e Linha Verde e contaria com um extenso trabalho de modificação da estação do Campo Grande.
                        </p>
                    </div>

                    <div class="col-md-6" id="metro">
                        <p><img id="metroHome" src="https://lh6.googleusercontent.com/proxy/NHkDz7Kj0t0grjTKasvOea01tT-wt9-hCHa1aRgK6FXPlLBCIujWTomXujhpXgK0srRiKyt1GmDlxiZSgLLY1mtDi3fzP-2m3tL8puWQr9uhQktbNq_i=pf-w200-h200">
                            A Companhia de Carris de Ferro de Lisboa (C.C.F.L., CCFL, ou simplesmente Carris) é uma empresa de transporte público de passageiros da cidade de Lisboa, Portugal. Foi fundada em 1872 e era desde 1975 tutelada pela Secretaria de Estado das Obras Públicas, dos Transportes e das Comunicações dependente do Ministério da Economia (e equivalentes diacrónicos). Porém, em 2015, o XXI Governo Constitucional decidiu que as empresas de transportes colectivos de Lisboa e do Porto ficariam sob a alçada do Ministério do Ambiente.[1]

                            Desde 1 de fevereiro de 2017, a gestão da Carris é tutelada pela Câmara Municipal de Lisboa. O acordo assinado entre o Ministério do Ambiente e a Câmara Municipal de Lisboa foi assinado a 19 de novembro de 2016.
                        </p>
                    </div>
                </div>
                <hr>
            </div>
            <footer>
                <div class="container">

                    <!--Grid row-->
                    <div class="row d-flex justify-content-center">

                        <!--Grid column-->
                        <div class="col-md-12">
                            <div class="embed-responsive embed-responsive-16by9 mb-4">
                                <iframe class="video" src="https://www.youtube.com/embed/AjtvE1Lt-fM" width="560" height="315" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>

        </div>

        <div id="mapa" class="tab-pane fade">
            <div id="map_canvas"></div>
        </div>
        <div id="estatisticas" class="tab-pane fade">
            <div id="chart-container">
                <h2>Estatísticas</h2>
                <span class="b">
                    <div id="estatisticas1">
                    </div>
                </span>
                <span class="b">
                    <div id="estatisticas2">
                    </div>
                </span>
                <div id="estatisticas3">
                </div>
            </div>
        </div>
        <div id="fale_connosco" class="tab-pane fade">
            <form action="/comunicar" method="post">
                <h1>Fale Connosco</h1>
                <p>*Nome: <input type="text" name="nome"><span id="nome"></span></p>
                <p>*Apelido: <input type="text" name="apelido"><span id="apelido"></span></p>
                <p>*Localidade: <input type="text" name="localidade"><span id="localidade"></span></p>
                <p>*E-mail: <input type="text" name="email"><span id="email"></span></p>
                <p>*Telefone: <input type="number" name="telefone"><span id="telefone"></span></p>
                <p>*Assunto: <input type="text" name="assunto"><span id="assunto"></span></p>
                <p>*A sua mensagem: <br><textarea name="mensagem" style="width:250px;height:150px;"></textarea><span id="mensagem"></span></p>
                <p>*Campos Obrigatórios</p>
                <input type="submit" value="Enviar">
            </form>

        </div>
    </div>
    <script>
        $('#Mapa').click(function(e) {
            setTimeout(function() {
                map.invalidateSize()
            }, 500);

            var lat = 38.7071; //center
            var long = -9.13549; //center
            var map = L.map('map_canvas').setView([lat, long], 11.5);
            //mapa tile init
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var freguesiaStyle = {
                "color": "#EDA24C",
                "weight": 5,
                "opacity": 0.65
            };
            // metro icon
            var mIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });
            //button icon
            var fIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });



            function onEachFeature(feature, layer) {
                if (feature.properties.INF_NOME) {
                    layer.setIcon(mIcon);
                    if (feature.properties.INF_DESCRICAO == "NULL") {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".");
                    } else {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".<br> Correspondente à " + feature.properties.INF_DESCRICAO + ".");
                    }
                }

            }
            L.geoJSON(metro, {
                onEachFeature: onEachFeature
            }).addTo(map);


            $.getJSON('http://localhost:3000/getCoordenadas', function(data) {
                /*var items = {
                    "type":"LineString",
                    "coordinates": []
                });*/
                var items = [];
                for (point in data)
                    items.push([
                        [data[point].ORIGIN_LATITUDE, data[point].ORIGIN_LONGITUDE],
                        [data[point].DESTINATION_LATITUDE, data[point].DESTINATION_LONGITUDE, data[point].NAME]
                    ]);




                L.polyline(items, {
                        color: 'red'
                    }).bindPopup()
                    .addTo(map)
                    .showMeasurements();


            });

            var helloPopup = L.popup().setContent('Este é o centro de Lisboa!');
            //Center map of Lisbon
            L.easyButton('<img src="https://img.icons8.com/material/24/000000/center-direction.png" style="width:16px" >', function(btn, map) {
                helloPopup.setLatLng(map.getCenter()).openOn(map);
                map.setView([lat, long], 11.5);

            }).addTo(map);


            function onEachFreguesia(feature, layer) {
                if (feature.properties && feature.properties.NOME) {
                    layer.bindPopup(feature.properties.NOME);
                }
            }


            var stateChangingButton = L.easyButton({
                states: [{
                    stateName: 'showFreguesias', // name the state
                    icon: 'fa-tree', // and define its properties
                    title: 'mostra freguesias', // like its title
                    onClick: function(btn, map) { // and its callback
                        geojsonLayer = L.geoJSON(freguesias, {
                            style: freguesiaStyle,
                            onEachFeature: onEachFreguesia
                        });
                        geojsonLayer.addTo(map);
                        btn.state('hideFreguesias'); // change state on click!   // change state on click!
                    }
                }, {
                    stateName: 'hideFreguesias',
                    icon: 'fa-university',
                    title: 'esconde freguesias',
                    onClick: function(btn, map) {
                        map.setView([lat, long], );
                        map.removeLayer(geojsonLayer);

                        btn.state('showFreguesias');
                    }
                }]
            });

            stateChangingButton.addTo(map);

function onLocationFound(e) {
			var radius = e.accuracy / 2;

//Create pop-up to display location accuracy.  Location is coming from IP location or GPS receiver in mobile device
			L.marker(e.latlng).addTo(map)
				.bindPopup("You are within " + radius + " meters from this point").openPopup();

//Create circle to graphically represent location accuracy
			L.circle(e.latlng, radius).addTo(map);
		}

//Code for handling any errors that come up
		function onLocationError(e) {
			alert(e.message);
		}

		map.on('locationfound', onLocationFound);
		map.on('locationerror', onLocationError);

//Locate point and zoom to that location with a zoom level of 16
		map.locate({setView: true, maxZoom: 16});

        });

    </script>

</body>

</html>
