<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.css">
    <script src="https://unpkg.com/leaflet-measure-path@1.3.1/leaflet-measure-path.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="geojson/freguesias.geojson"></script>
    <script src="geojson/metro.geojson"></script>

    <link rel="stylesheet" href="css/dashboard.css">
    <title> Dashboard </title>

</head>

<style>
    body {
        font-family: "Raleway", Sans-serif;
        -webkit-font-smoothing: antialiased;
    }

    .tab-content {

        padding-left: 50px;
        padding-right: 50px;
        text-align: justify;
    }



    h1,
    h2,
    h3,
    h4,
    h5 {
        letter-spacing: -0.04em;
        font-weight: 700;
        font-style: normal;
        font-family: "Raleway", Sans-serif;
        color: #4A4A4A;
    }

    p {
        font-family: 'Raleway', sans-serif;
        font-size: 15px;
        font-weight: 400;
        line-height: 24px;
        color: #000;
    }

    #logo {
        height: 35%;
        width: 35%;

    }




    #map_canvas {
        display: block;
        margin-left: auto;
        margin-right: auto;

        height: 700px;

    }

</style>


<body>


    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="https://www.thalesgroup.com/en">Thales</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a id="Home" data-toggle="pill" href="#home">Home</a></li>
                <li><a id="Mapa" data-toggle="pill" href="#mapa">Mapa</a></li>
                <li><a id="Estatisticas" data-toggle="pill" href="#estatisticas">Estatísticas</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a> Logout </a></li>
            </ul>
        </div>
    </nav>


    <div class="tab-content" style="padding-top: 10px ">
        <div id="home" class="tab-pane fade in active">
            <!-- w3-content defines a container for fixed size centered content,
and is wrapped around the whole page content, except for the footer in this example -->
            <div class="w3-content" style="max-width:1400px">

                <!-- Header -->
                <header class="w3-container w3-center w3-padding-32">
                    <h1>COMO-TE-MOVES</h1>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Thales_Logo.svg/640px-Thales_Logo.svg.png" alt="thalesLogo" height="110px" width="640px">
                </header>

                <!-- Grid -->
                <div class="w3-row">

                    <!-- Blog entries -->
                    <div class="w3-col l8 s12">
                        <!-- Blog entry -->
                        <div class="w3-card-4 w3-margin w3-white">
                            <img src="/w3images/woods.jpg" alt="Nature" style="width:100%">
                            <div class="w3-container">
                                <h3><b>TITLE HEADING</b></h3>
                                <h5>Title description, <span class="w3-opacity">April 7, 2014</span></h5>
                            </div>

                            <div class="w3-container">
                                <p>Mauris neque quam, fermentum ut nisl vitae, convallis maximus nisl. Sed mattis nunc id lorem euismod placerat. Vivamus porttitor magna enim, ac accumsan tortor cursus at. Phasellus sed ultricies mi non congue ullam corper. Praesent tincidunt sed
                                    tellus ut rutrum. Sed vitae justo condimentum, porta lectus vitae, ultricies congue gravida diam non fringilla.</p>
                                <div class="w3-row">
                                    <div class="w3-col m8 s12">
                                        <p><button class="w3-button w3-padding-large w3-white w3-border"><b>READ MORE »</b></button></p>
                                    </div>
                                    <div class="w3-col m4 w3-hide-small">
                                        <p><span class="w3-padding-large w3-right"><b>Comments  </b> <span class="w3-tag">0</span></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>

                        <!-- Blog entry -->
                        <div class="w3-card-4 w3-margin w3-white">
                            <img src="/w3images/bridge.jpg" alt="Norway" style="width:100%">
                            <div class="w3-container">
                                <h3><b>BLOG ENTRY</b></h3>
                                <h5>Title description, <span class="w3-opacity">April 2, 2014</span></h5>
                            </div>

                            <div class="w3-container">
                                <p>Mauris neque quam, fermentum ut nisl vitae, convallis maximus nisl. Sed mattis nunc id lorem euismod placerat. Vivamus porttitor magna enim, ac accumsan tortor cursus at. Phasellus sed ultricies mi non congue ullam corper. Praesent tincidunt sed
                                    tellus ut rutrum. Sed vitae justo condimentum, porta lectus vitae, ultricies congue gravida diam non fringilla.</p>
                                <div class="w3-row">
                                    <div class="w3-col m8 s12">
                                        <p><button class="w3-button w3-padding-large w3-white w3-border"><b>READ MORE »</b></button></p>
                                    </div>
                                    <div class="w3-col m4 w3-hide-small">
                                        <p><span class="w3-padding-large w3-right"><b>Comments  </b> <span class="w3-badge">2</span></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- END BLOG ENTRIES -->
                    </div>

                    <!-- Introduction menu -->
                    <div class="w3-col l4">
                        <!-- About Card -->
                        <div class="w3-card w3-margin w3-margin-top">
                            <img src="/w3images/avatar_g.jpg" style="width:100%">
                            <div class="w3-container w3-white">
                                <h4><b>My Name</b></h4>
                                <p>Just me, myself and I, exploring the universe of uknownment. I have a heart of love and a interest of lorem ipsum and mauris neque quam blog. I want to share my world with you.</p>
                            </div>
                        </div>
                        <hr>

                        <!-- Posts -->
                        <div class="w3-card w3-margin">
                            <div class="w3-container w3-padding">
                                <h4>Popular Posts</h4>
                            </div>
                            <ul class="w3-ul w3-hoverable w3-white">
                                <li class="w3-padding-16">
                                    <img src="/w3images/workshop.jpg" alt="Image" class="w3-left w3-margin-right" style="width:50px">
                                    <span class="w3-large">Lorem</span><br>
                                    <span>Sed mattis nunc</span>
                                </li>
                                <li class="w3-padding-16">
                                    <img src="/w3images/gondol.jpg" alt="Image" class="w3-left w3-margin-right" style="width:50px">
                                    <span class="w3-large">Ipsum</span><br>
                                    <span>Praes tinci sed</span>
                                </li>
                                <li class="w3-padding-16">
                                    <img src="/w3images/skies.jpg" alt="Image" class="w3-left w3-margin-right" style="width:50px">
                                    <span class="w3-large">Dorum</span><br>
                                    <span>Ultricies congue</span>
                                </li>
                                <li class="w3-padding-16 w3-hide-medium w3-hide-small">
                                    <img src="/w3images/rock.jpg" alt="Image" class="w3-left w3-margin-right" style="width:50px">
                                    <span class="w3-large">Mingsum</span><br>
                                    <span>Lorem ipsum dipsum</span>
                                </li>
                            </ul>
                        </div>
                        <hr>

                        <!-- Labels / tags -->
                        <div class="w3-card w3-margin">
                            <div class="w3-container w3-padding">
                                <h4>Tags</h4>
                            </div>
                            <div class="w3-container w3-white">
                                <p><span class="w3-tag w3-black w3-margin-bottom">Travel</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">New York</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">London</span>
                                    <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">IKEA</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">NORWAY</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">DIY</span>
                                    <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Ideas</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Baby</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Family</span>
                                    <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">News</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Clothing</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Shopping</span>
                                    <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Sports</span> <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Games</span>
                                </p>
                            </div>
                        </div>

                        <!-- END Introduction Menu -->
                    </div>

                    <!-- END GRID -->
                </div><br>

                <!-- END w3-content -->
            </div>

            <!-- Footer -->
            <footer class="w3-container w3-dark-grey w3-padding-32 w3-margin-top">

            </footer>
        </div>
        <div id="mapa" class="tab-pane fade">
            <div id="map_canvas"></div>

        </div>
        <div id="estatisticas" class="tab-pane fade">
            <div id="chart-container">Graficos
                <div id="estatisticas1">
                </div>
                <div id="estatisticas2">
                </div>
                <div id="estatisticas3">
                </div>
            </div>
        </div>
    </div>

    <script>
        //Estatisticas Tab with chart.js

             google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            $.getJSON('http://localhost:3000/getEstatisticas1', function(data) {
                console.log(data);
                var items = [['Age', 'Number']];
                for(item in data) {
                    var i = [data[item].Age, parseInt(data[item].Number)];
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Faixa Etária',
                    width:900,
                    height:500
                };

                var chart = new google.visualization.BarChart(document.getElementById('estatisticas1'));

                chart.draw(dataTable, options);

            });

                //------------------------------------------------------

            $.getJSON('http://localhost:3000/getEstatisticas2', function(data) {
                var items = [['Tranport', 'Number']];
                for(item in data) {
                    var i = [data[item].Transport, parseInt(data[item].Number)];
                    console.log(i);
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Transporte',
                    width:900,
                    height:500
                };

                var chart = new google.visualization.PieChart(document.getElementById('estatisticas2'));
                chart.draw(dataTable, options);


            });

        //---------------------------------------------------------------------------------------------------

        $.getJSON('http://localhost:3000/getEstatisticas3', function(data) {
                var items = [['Hour', 'Number']];
                for(item in data) {
                    var i = [data[item].Hour, parseInt(data[item].Number)];
                    console.log(i);
                    items.push(i);
                }
                var dataTable = google.visualization.arrayToDataTable(items);
                var options = {
                    title: 'Transporte',
                    width:900,
                    height:500
                };

                var chart = new google.visualization.LineChart(document.getElementById('estatisticas3'));
                chart.draw(dataTable, options);

            });
        }

        //map tab with leaflet

        $('#Mapa').click(function(e) {
            setTimeout(function() {
                map.invalidateSize()
            }, 500);

            var lat = 38.7071; //center
            var long = -9.13549; //center
            var map = L.map('map_canvas').setView([lat, long], 11.5);
            //mapa tile init
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var freguesiaStyle = {
                "color": "#EDA24C",
                "weight": 5,
                "opacity": 0.65
            };
            // metro icon
            var mIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });
            //button icon
            var fIcon = L.icon({
                iconUrl: "https://image.flaticon.com/icons/svg/50/50399.svg",
                iconSize: [10, 10], // size of the icon
            });



            function onEachFeature(feature, layer) {
                if (feature.properties.INF_NOME) {
                    layer.setIcon(mIcon);
                    if (feature.properties.INF_DESCRICAO == "NULL") {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".");
                    } else {
                        layer.bindPopup("Estação de metro " + feature.properties.INF_NOME + ".<br> Correspondente à " + feature.properties.INF_DESCRICAO + ".");
                    }
                }

            }
            L.geoJSON(metro, {
                onEachFeature: onEachFeature
            }).addTo(map);


            $.getJSON('http://localhost:3000/getCoordenadas', function(data) {
                /*var items = {
                    "type":"LineString",
                    "coordinates": []
                });*/
                var items = [];
                for (point in data)
                    items.push([
                        [data[point].ORIGIN_LATITUDE, data[point].ORIGIN_LONGITUDE],
                        [data[point].DESTINATION_LATITUDE, data[point].DESTINATION_LONGITUDE, data[point].NAME]
                    ]);




                L.polyline(items, {
                        color: 'red'
                    }).bindPopup()
                    .addTo(map)
                    .showMeasurements();


            });

            var helloPopup = L.popup().setContent('Este é o centro de Lisboa!');
            //Center map of Lisbon
            L.easyButton('<img src="https://img.icons8.com/material/24/000000/center-direction.png" style="width:16px" >', function(btn, map) {
                helloPopup.setLatLng(map.getCenter()).openOn(map);
                map.setView([lat, long], 11.5);

            }).addTo(map);


            function onEachFreguesia(feature, layer) {
                if (feature.properties && feature.properties.NOME) {
                    layer.bindPopup(feature.properties.NOME);
                }
            }


            var stateChangingButton = L.easyButton({
                states: [{
                    stateName: 'showFreguesias', // name the state
                    icon: 'fa-tree', // and define its properties
                    title: 'mostra freguesias', // like its title
                    onClick: function(btn, map) { // and its callback
                        geojsonLayer = L.geoJSON(freguesias, {
                            style: freguesiaStyle,
                            onEachFeature: onEachFreguesia
                        });
                        geojsonLayer.addTo(map);
                        btn.state('hideFreguesias'); // change state on click!   // change state on click!
                    }
                }, {
                    stateName: 'hideFreguesias',
                    icon: 'fa-university',
                    title: 'esconde freguesias',
                    onClick: function(btn, map) {
                        map.setView([lat, long], );
                        map.removeLayer(geojsonLayer);

                        btn.state('showFreguesias');
                    }
                }]
            });

            stateChangingButton.addTo(map);



        });

    </script>
</body>

</html>
